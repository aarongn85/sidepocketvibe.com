<?php 
// Try to load articles from database, but don't fail if DB not available
$articles = [];
$featured = null;

try {
    if (class_exists('Database') && Database::getInstance()->isConnected()) {
        $articleManager = getArticleManager();
        $articles = $articleManager->getArticles(['limit' => 6]);
        
        // Get featured article
        $featuredArticles = $articleManager->getArticles(['featured_only' => true, 'limit' => 1]);
        $featured = $featuredArticles[0] ?? null;
    }
} catch (Exception $e) {
    // Database not available - will use dummy data below
}

// If no featured article from database, use dummy data
if (!$featured) {
    $featured = [
        'title' => 'The Evolution of 9-Ball: From Prohibition Era to Modern Championship',
        'excerpt' => 'Discover how 9-ball pool transformed from a gambling game in smoky halls to one of the most prestigious professional sports in the billiards world.',
        'slug' => 'evolution-of-9-ball',
        'image' => 'https://images.unsplash.com/photo-1626925217951-4d5d4b5c1e4c?w=1200&h=600&fit=crop',
        'author' => 'Mike Sullivan',
        'date' => date('Y-m-d', strtotime('-2 days'))
    ];
    
    $articles = [
        [
            'title' => 'Mastering the Break Shot: Physics and Technique',
            'excerpt' => 'Learn the science behind the perfect break shot and how professional players generate maximum power while maintaining control.',
            'slug' => 'mastering-break-shot',
            'featured_image' => 'https://images.unsplash.com/photo-1609710228159-0fa9bd7c0827?w=400&h=300&fit=crop',
            'author_name' => 'Sarah Chen',
            'published_at' => date('Y-m-d', strtotime('-1 week'))
        ],
        [
            'title' => 'Inside the Mind of Efren Reyes: The Magician\'s Greatest Shots',
            'excerpt' => 'A retrospective look at the legendary Filipino player and the incredible shots that earned him the nickname "The Magician".',
            'slug' => 'efren-reyes-greatest-shots',
            'featured_image' => 'https://images.unsplash.com/photo-1566140967404-b8b3932483f5?w=400&h=300&fit=crop',
            'author_name' => 'James Martinez',
            'published_at' => date('Y-m-d', strtotime('-3 days'))
        ],
        [
            'title' => 'Cue Selection Guide: Finding Your Perfect Match',
            'excerpt' => 'Everything you need to know about choosing a pool cue, from weight and balance to wood types and custom options.',
            'slug' => 'cue-selection-guide',
            'featured_image' => 'https://images.unsplash.com/photo-1626925217951-4d5d4b5c1e4c?w=400&h=300&fit=crop',
            'author_name' => 'Tony Romano',
            'published_at' => date('Y-m-d', strtotime('-5 days'))
        ],
        [
            'title' => 'The Rise of Women in Professional Pool',
            'excerpt' => 'How female players are breaking barriers and competing at the highest levels of professional billiards.',
            'slug' => 'women-in-professional-pool',
            'featured_image' => 'https://images.unsplash.com/photo-1561052967-61fc91e48d79?w=400&h=300&fit=crop',
            'author_name' => 'Emma Rodriguez',
            'published_at' => date('Y-m-d', strtotime('-1 week'))
        ],
        [
            'title' => 'Pool Hall Culture: Then and Now',
            'excerpt' => 'Exploring how pool halls have evolved from rough gambling dens to modern social spaces and sports venues.',
            'slug' => 'pool-hall-culture',
            'featured_image' => 'https://images.unsplash.com/photo-1609710228159-0fa9bd7c0827?w=400&h=300&fit=crop',
            'author_name' => 'Mike Sullivan',
            'published_at' => date('Y-m-d', strtotime('-2 weeks'))
        ],
        [
            'title' => 'Advanced Bank Shot Techniques for Tournament Play',
            'excerpt' => 'Master the geometry and execution of bank shots with tips from professional players and coaches.',
            'slug' => 'advanced-bank-shots',
            'featured_image' => 'https://images.unsplash.com/photo-1566140967404-b8b3932483f5?w=400&h=300&fit=crop',
            'author_name' => 'Sarah Chen',
            'published_at' => date('Y-m-d', strtotime('-10 days'))
        ]
    ];
}

// If no articles from database, use the dummy ones above
if (empty($articles)) {
    $articles = [
        [
            'title' => 'Mastering the Break Shot: Physics and Technique',
            'excerpt' => 'Learn the science behind the perfect break shot and how professional players generate maximum power while maintaining control.',
            'slug' => 'mastering-break-shot',
            'featured_image' => 'https://images.unsplash.com/photo-1609710228159-0fa9bd7c0827?w=400&h=300&fit=crop',
            'author_name' => 'Sarah Chen',
            'published_at' => date('Y-m-d', strtotime('-1 week'))
        ],
        [
            'title' => 'Inside the Mind of Efren Reyes: The Magician\'s Greatest Shots',
            'excerpt' => 'A retrospective look at the legendary Filipino player and the incredible shots that earned him the nickname "The Magician".',
            'slug' => 'efren-reyes-greatest-shots',
            'featured_image' => 'https://images.unsplash.com/photo-1566140967404-b8b3932483f5?w=400&h=300&fit=crop',
            'author_name' => 'James Martinez',
            'published_at' => date('Y-m-d', strtotime('-3 days'))
        ],
        [
            'title' => 'Cue Selection Guide: Finding Your Perfect Match',
            'excerpt' => 'Everything you need to know about choosing a pool cue, from weight and balance to wood types and custom options.',
            'slug' => 'cue-selection-guide',
            'featured_image' => 'https://images.unsplash.com/photo-1626925217951-4d5d4b5c1e4c?w=400&h=300&fit=crop',
            'author_name' => 'Tony Romano',
            'published_at' => date('Y-m-d', strtotime('-5 days'))
        ],
        [
            'title' => 'The Rise of Women in Professional Pool',
            'excerpt' => 'How female players are breaking barriers and competing at the highest levels of professional billiards.',
            'slug' => 'women-in-professional-pool',
            'featured_image' => 'https://images.unsplash.com/photo-1561052967-61fc91e48d79?w=400&h=300&fit=crop',
            'author_name' => 'Emma Rodriguez',
            'published_at' => date('Y-m-d', strtotime('-1 week'))
        ],
        [
            'title' => 'Pool Hall Culture: Then and Now',
            'excerpt' => 'Exploring how pool halls have evolved from rough gambling dens to modern social spaces and sports venues.',
            'slug' => 'pool-hall-culture',
            'featured_image' => 'https://images.unsplash.com/photo-1609710228159-0fa9bd7c0827?w=400&h=300&fit=crop',
            'author_name' => 'Mike Sullivan',
            'published_at' => date('Y-m-d', strtotime('-2 weeks'))
        ],
        [
            'title' => 'Advanced Bank Shot Techniques for Tournament Play',
            'excerpt' => 'Master the geometry and execution of bank shots with tips from professional players and coaches.',
            'slug' => 'advanced-bank-shots',
            'featured_image' => 'https://images.unsplash.com/photo-1566140967404-b8b3932483f5?w=400&h=300&fit=crop',
            'author_name' => 'Sarah Chen',
            'published_at' => date('Y-m-d', strtotime('-10 days'))
        ]
    ];
}

require_once APP_PATH . '/views/layouts/header.php'; 
?>

<!-- Hero Section with Article Carousel and Discord -->
<section class="hero">
    <div class="hero-content">
        <div class="hero-featured">
            <div class="hero-slider">
                <?php 
                // Combine featured and regular articles for slider
                $sliderArticles = array_merge([$featured], array_slice($articles, 0, 5));
                foreach ($sliderArticles as $index => $slide): 
                    // Use 'image' for featured, 'featured_image' for regular articles
                    $slideImage = $slide['image'] ?? $slide['featured_image'] ?? 'https://images.unsplash.com/photo-1626925217951-4d5d4b5c1e4c?w=1200&h=600&fit=crop';
                    $slideAuthor = $slide['author'] ?? $slide['author_name'] ?? 'Staff Writer';
                    $slideDate = $slide['date'] ?? $slide['published_at'] ?? date('Y-m-d');
                ?>
                <div class="hero-slide <?php echo $index === 0 ? 'active' : ''; ?>" data-slide="<?php echo $index; ?>">
                    <div class="hero-image">
                        <img src="<?php echo htmlspecialchars($slideImage); ?>" alt="<?php echo htmlspecialchars($slide['title']); ?>">
                    </div>
                    <div class="hero-text">
                        <span class="hero-label">Featured Article</span>
                        <h2><?php echo htmlspecialchars($slide['title']); ?></h2>
                        <p class="hero-excerpt"><?php echo htmlspecialchars($slide['excerpt']); ?></p>
                        <div class="hero-meta">
                            <span class="author">By <?php echo htmlspecialchars($slideAuthor); ?></span>
                            <span class="date"><?php echo date('F j, Y', strtotime($slideDate)); ?></span>
                        </div>
                        <a href="/article/<?php echo htmlspecialchars($slide['slug']); ?>" class="btn btn-primary">Read More</a>
                    </div>
                </div>
                <?php endforeach; ?>
                
                <!-- View All Articles Slide -->
                <div class="hero-slide hero-slide-viewall" data-slide="<?php echo count($sliderArticles); ?>">
                    <div class="hero-viewall-content">
                        <h2>Explore All Articles</h2>
                        <p class="hero-excerpt">Discover more billiards news, tips, and stories from the pool community.</p>
                        <a href="/articles" class="btn btn-primary">View All Articles</a>
                    </div>
                </div>
                
                <!-- Slider Controls -->
                <button class="hero-slider-btn hero-slider-prev" aria-label="Previous article">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                </button>
                <button class="hero-slider-btn hero-slider-next" aria-label="Next article">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 18 15 12 9 6"></polyline>
                    </svg>
                </button>
                
                <!-- Slider Dots -->
                <div class="hero-slider-dots">
                    <?php for ($i = 0; $i <= count($sliderArticles); $i++): ?>
                    <button class="hero-slider-dot <?php echo $i === 0 ? 'active' : ''; ?>" data-slide="<?php echo $i; ?>" aria-label="Go to slide <?php echo $i + 1; ?>"></button>
                    <?php endfor; ?>
                </div>
            </div>
        </div>
        
        <!-- Discord Sidebar in Hero -->
        <aside class="discord-sidebar hero-discord">
            <div class="discord-header">
                <h3>
                    <svg class="discord-icon" viewBox="0 0 127.14 96.36" xmlns="http://www.w3.org/2000/svg">
                        <path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/>
                    </svg>
                    Discord Community
                </h3>
            </div>
            
            <div class="discord-channels">
                <div class="discord-channel active">general-chat</div>
                <div class="discord-channel">pool-tips</div>
                <div class="discord-channel">tournament-talk</div>
            </div>
            
            <div class="discord-messages">
                <div class="discord-message">
                    <div class="discord-avatar">SP</div>
                    <div class="discord-message-content">
                        <div class="discord-message-header">
                            <span class="discord-username">SidePocket</span>
                            <span class="discord-timestamp">Today at 2:34 PM</span>
                        </div>
                        <div class="discord-message-text">New article just dropped! Check out "The Evolution of 9-Ball" üé±</div>
                    </div>
                </div>
                
                <div class="discord-message">
                    <div class="discord-avatar">RM</div>
                    <div class="discord-message-content">
                        <div class="discord-message-header">
                            <span class="discord-username">RackMaster</span>
                            <span class="discord-timestamp">Today at 1:15 PM</span>
                        </div>
                        <div class="discord-message-text">Anyone heading to the tournament this weekend?</div>
                    </div>
                </div>
                
                <div class="discord-message">
                    <div class="discord-avatar">CP</div>
                    <div class="discord-message-content">
                        <div class="discord-message-header">
                            <span class="discord-username">CueProdigy</span>
                            <span class="discord-timestamp">Today at 12:45 PM</span>
                        </div>
                        <div class="discord-message-text">That break shot technique article was super helpful! üí™</div>
                    </div>
                </div>
                
                <div class="discord-message">
                    <div class="discord-avatar">8B</div>
                    <div class="discord-message-content">
                        <div class="discord-message-header">
                            <span class="discord-username">8BallKing</span>
                            <span class="discord-timestamp">Today at 11:20 AM</span>
                        </div>
                        <div class="discord-message-text">Looking for practice partners in the SF Bay Area</div>
                    </div>
                </div>
                
                <div class="discord-message">
                    <div class="discord-avatar">BC</div>
                    <div class="discord-message-content">
                        <div class="discord-message-header">
                            <span class="discord-username">BankCredits</span>
                            <span class="discord-timestamp">Today at 10:05 AM</span>
                        </div>
                        <div class="discord-message-text">Just hit my first perfect break! The physics really matter üî•</div>
                    </div>
                </div>
            </div>
            
            <div class="discord-footer">
                <a href="#" class="discord-join-btn">Join Our Discord</a>
            </div>
        </aside>
    </div>
</section>

<!-- Latest Articles Section -->
<section class="content-sections">
    <div class="container">
        
        <!-- Latest News -->
        <div class="content-section">
            <div class="section-header">
                <h2 class="section-title">
                    <span class="section-icon">üì∞</span>
                    Latest News
                </h2>
                <a href="/articles" class="section-link">View All ‚Üí</a>
            </div>
            <div class="news-layout">
                <!-- Main Featured Article -->
                <?php if (isset($articles[0])): $article = $articles[0]; ?>
                <article class="news-featured">
                    <?php if (!empty($article['featured_image'])): ?>
                    <div class="news-featured-image">
                        <img src="<?php echo htmlspecialchars($article['featured_image']); ?>" alt="<?php echo htmlspecialchars($article['title']); ?>">
                        <span class="news-badge">Top Story</span>
                    </div>
                    <?php endif; ?>
                    <div class="news-featured-content">
                        <h3><a href="/article/<?php echo htmlspecialchars($article['slug']); ?>"><?php echo htmlspecialchars($article['title']); ?></a></h3>
                        <p class="news-excerpt"><?php echo htmlspecialchars($article['excerpt'] ?? ''); ?></p>
                        <div class="news-meta">
                            <?php if (!empty($article['author_name'])): ?>
                            <span class="author">‚úçÔ∏è <?php echo htmlspecialchars($article['author_name']); ?></span>
                            <?php endif; ?>
                            <?php if (!empty($article['published_at'])): ?>
                            <span class="date">üïí <?php echo date('M j, Y', strtotime($article['published_at'])); ?></span>
                            <?php endif; ?>
                        </div>
                    </div>
                </article>
                <?php endif; ?>
                
                <!-- Side Articles List -->
                <div class="news-sidebar">
                    <?php 
                    // Show next 3 articles
                    for ($i = 1; $i < 4 && $i < count($articles); $i++): 
                        $article = $articles[$i];
                        $isFirst = ($i === 1);
                    ?>
                    <article class="news-compact <?php echo $isFirst ? 'news-compact-highlight' : ''; ?>">
                        <?php if (!empty($article['featured_image'])): ?>
                        <div class="news-compact-image">
                            <img src="<?php echo htmlspecialchars($article['featured_image']); ?>" alt="<?php echo htmlspecialchars($article['title']); ?>">
                        </div>
                        <?php endif; ?>
                        <div class="news-compact-content">
                            <?php if ($isFirst): ?>
                            <span class="news-compact-badge">Trending</span>
                            <?php endif; ?>
                            <h4><a href="/article/<?php echo htmlspecialchars($article['slug']); ?>"><?php echo htmlspecialchars($article['title']); ?></a></h4>
                            <div class="news-compact-meta">
                                <?php if (!empty($article['author_name'])): ?>
                                <span class="author"><?php echo htmlspecialchars($article['author_name']); ?></span>
                                <?php endif; ?>
                                <?php if (!empty($article['published_at'])): ?>
                                <span class="date"><?php echo date('M j', strtotime($article['published_at'])); ?></span>
                                <?php endif; ?>
                            </div>
                        </div>
                    </article>
                    <?php endfor; ?>
                </div>
            </div>
        </div>

        <!-- Two Column Layout for Learning Resources & Events -->
        <div class="content-section-row">
            
            <!-- Learning Resources -->
            <div class="content-section content-section-half">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">üìö</span>
                        Learning Resources
                    </h2>
                    <a href="/articles?category=learning" class="section-link">View All ‚Üí</a>
                </div>
                <div class="resource-list">
                    <article class="resource-card">
                        <div class="resource-icon">üéØ</div>
                        <div class="resource-content">
                            <h4><a href="/article/mastering-break-shot">Mastering the Break Shot</a></h4>
                            <p>Learn the physics and technique behind perfect breaks</p>
                            <span class="resource-type">Tutorial</span>
                        </div>
                    </article>
                    <article class="resource-card">
                        <div class="resource-icon">üìê</div>
                        <div class="resource-content">
                            <h4><a href="/article/advanced-bank-shots">Advanced Bank Shot Techniques</a></h4>
                            <p>Master geometry and execution for tournament play</p>
                            <span class="resource-type">Advanced Guide</span>
                        </div>
                    </article>
                    <article class="resource-card">
                        <div class="resource-icon">üé±</div>
                        <div class="resource-content">
                            <h4><a href="/article/cue-selection-guide">Cue Selection Guide</a></h4>
                            <p>Everything you need to know about choosing your cue</p>
                            <span class="resource-type">Buyer's Guide</span>
                        </div>
                    </article>
                    <article class="resource-card">
                        <div class="resource-icon">üí™</div>
                        <div class="resource-content">
                            <h4><a href="/article/mental-game">The Mental Game</a></h4>
                            <p>Develop focus and confidence under pressure</p>
                            <span class="resource-type">Strategy</span>
                        </div>
                    </article>
                </div>
            </div>

            <!-- Tournaments & Events -->
            <div class="content-section content-section-half">
                <div class="section-header">
                    <h2 class="section-title">
                        <span class="section-icon">üèÜ</span>
                        Tournaments & Events
                    </h2>
                    <a href="/articles?category=events" class="section-link">View All ‚Üí</a>
                </div>
                <div class="events-list">
                    <article class="event-card event-featured">
                        <div class="event-date">
                            <span class="event-month">DEC</span>
                            <span class="event-day">15</span>
                        </div>
                        <div class="event-content">
                            <span class="event-badge">Featured</span>
                            <h4><a href="#">US Open 9-Ball Championship</a></h4>
                            <p class="event-location">üìç Las Vegas, NV</p>
                            <p class="event-description">The premier 9-ball tournament returns with $300K prize pool</p>
                        </div>
                    </article>
                    <article class="event-card">
                        <div class="event-date">
                            <span class="event-month">DEC</span>
                            <span class="event-day">22</span>
                        </div>
                        <div class="event-content">
                            <h4><a href="#">Mosconi Cup 2025</a></h4>
                            <p class="event-location">üìç London, UK</p>
                        </div>
                    </article>
                    <article class="event-card">
                        <div class="event-date">
                            <span class="event-month">JAN</span>
                            <span class="event-day">10</span>
                        </div>
                        <div class="event-content">
                            <h4><a href="#">World Pool Masters</a></h4>
                            <p class="event-location">üìç Gibraltar</p>
                        </div>
                    </article>
                    <article class="event-card">
                        <div class="event-date">
                            <span class="event-month">JAN</span>
                            <span class="event-day">25</span>
                        </div>
                        <div class="event-content">
                            <h4><a href="#">Derby City Classic</a></h4>
                            <p class="event-location">üìç Louisville, KY</p>
                        </div>
                    </article>
                </div>
            </div>
        </div>

    </div>
</section>

<?php require_once APP_PATH . '/views/layouts/footer.php'; ?>
